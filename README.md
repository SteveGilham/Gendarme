
# altcode.gendarme
A Mono.Gendarme fork built against the most recent Mono.Cecil that can load assemblies built with current compilers.

### Badges
* [![Nuget](https://buildstats.info/nuget/altcode.gendarme?includePreReleases=true) Command-line tool](https://www.nuget.org/packages/altcode.gendarme)
* [![Build status](https://img.shields.io/appveyor/ci/SteveGilham/Gendarme.svg)](https://ci.appveyor.com/project/SteveGilham/Gendarme)
* ![Build history](https://buildstats.info/appveyor/chart/SteveGilham/Gendarme)

## Build process from trunk as per `appveyor.yml`

* Assumes latest NuGet (5.4.0) and VS2013 build environment

NuGet restore .\packages.config -PackagesDirectory .\packages  
powershell .\set-version.ps1  
msbuild .\gendarme\gendarme-win.sln /p:Configuration=Release  
NuGet pack altcode.gendarme.nuspec

* the `msbuild` stage can be done in Visual Studio with the Debug configuration to run the unit tests

## Features
* Can load .net core assemblies 
  * but you may need to `dotnet publish` the code you want to analyse so Gendarme is able to pick up dependencies.  Otherwise there can be spurious warnings about e.g. virtual methods in sealed classes when that sealed class actually overrides a base-class virtual method.
* Will load debug information from embedded symbols or actual `.pdb` files if available even on non-Windows platforms.
  *  The main impact is that the `AvoidLongMethodsRule` works by LoC and not IL against .net core code on all platforms.

## Known Issues
The following rules (Test name follows rule name) have some unit test failures, so should not be relied upon

* Gendarme.Rules.Performance\Test\AvoidUnnecessaryOverridesTest
* Gendarme.Rules.Design\Test\ProvideTryParseAlternativeTest
* Gendarme.Rules.Serialization\Test\CallBaseMethodsOnISerializableTypesTest
* Gendarme.Rules.Correctness\Test\ProvideCorrectRegexPatternTest
* Gendarme.Rules.Concurrency\Test\ProtectCallToEventDelegatesTest
* Gendarme.Rules.Exceptions\Test\UseObjectDisposedExceptionTest

There is also a unit test failure for `Gendarme.Framework.Helpers\StackEntryAnalysisTest` which may affect any rules relating to `try`/`catch`/`finally` behaviour.

## Direction
After having achieved the first objective, of being able to analyze code from the new .net, the next goal of this fork is to make the tool more F# aware, because that's where I personally use it the most.

There are several places where F# code generation emits patterns that are detected by legacy Gendarme as erroneous, but which are not under the control of the developer. One example is the detection of accessor methods looking like `get_FieldName` generated by F# which trigger the `ConsiderConvertingMethodToPropertyRule` when to the casual observer they are indistinguishable from properties -- like the the unadorned cases in 
```
[<NoComparison>]
type ArgType =
  | Collect of CollectParams
  | Prepare of PrepareParams
  | ImportModule
  | GetVersion
```

Also, local functions `name@line-number::Invoke()`all trip `ParameterNamesShouldMatchOverriddenMethodRule` and the types `name@line-number` flag the `UseCorrectCasingRule`.  Local function closures also trigger `VariableNamesShouldNotMatchFieldNamesRule`, and maybe more.

### Progress to date
* Fix `AvoidMultidimensionalIndexerRule` for F# generated parameterless methods called `get_Item`
* Fix comparison of nested type names in parameters against supplied types
* Ignore [CompilerGenerated] methods for `AvoidSwitchStatementsRule` and `CheckParametersNullityInVisibleMethodsRule`
* Ignore [CompilerGenerated] fields and methods for `VariableNamesShouldNotMatchFieldNamesRule`
* Ignore `<StartupCode$` names in `UseCorrectCasingRule`
* Ignore generated types containg `@` in their names for `AvoidUnsealedUninheritedInternalTypesRule`
* Ignore the `Tags` generted type inside union types for `AvoidVisibleConstantFieldRule`
